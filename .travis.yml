os: osx
osx_image: xcode11.6
language: swift

stage: Build
env:
  matrix:
    include:
    - xcode_scheme: ParseSwift (iOS)
      xcode_destination: platform=iOS Simulator,OS=13.6,name=iPhone 11 Pro Max
    - xcode_scheme: ParseSwift (macOS)
      xcode_destination: platform=MacOSX
    - xcode_scheme: ParseSwift (tvOS)
      xcode_destination: platform=AppleTV Simulator,OS=13.4,name=Apple TV
    - xcode_scheme: ParseSwift (watchOS)
      xcode_destination: platform=watchOS Simulator,OS=6.2,name=Apple Watch Series 5 - 44mm

jobs:
  include:
    - stage: Package Managers
      env: Swift Pacakge Manager
      script: 
        - swift build
        - swift test --enable-code-coverage
      after_success:
        - xcrun llvm-cov export -format="lcov" .build/debug/ParseSwiftPackageTests.xctest/Contents/MacOS/ParseSwiftPackageTests -instr-profile .build/debug/codecov/default.profdata > info.lcov
        - bash <(curl https://codecov.io/bash) 
        - gem install jazzy
        - ./Scripts/jazzy.sh
    - stage: Package Managers
      env: Cocoapods
      script: pod lib lint
    - stage: Package Managers
      env: Carthage
      script: carthage build --no-skip-current
